# ğŸ¯ å³æ—¶é€šè®¯èŠå¤©åº”ç”¨ - ä¸€é”®é…ç½®æŒ‡å—

## ğŸš€ è¶…ç®€å•é…ç½®ï¼ˆåªéœ€5åˆ†é’Ÿï¼‰

ä½ çš„åº”ç”¨åœ°å€ï¼š**https://goakay1ooz7z.space.minimaxi.com**

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆé…ç½®ï¼š

### ç¬¬1æ­¥ï¼šå¼€å¯é‚®ç®±è®¤è¯ï¼ˆ1åˆ†é’Ÿï¼‰
1. æ‰“å¼€ [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©é¡¹ç›®ï¼š`injaqmzsqssxefxrglan`
3. è¿›å…¥ `Authentication` â†’ `Providers`
4. æ‰¾åˆ° `Email`ï¼Œç‚¹å‡»å¼€å¯
5. ç‚¹å‡» `Save`

### ç¬¬2æ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆ2åˆ†é’Ÿï¼‰
1. è¿›å…¥ `SQL Editor`
2. ç‚¹å‡» `New query`
3. **å¤åˆ¶ç²˜è´´ä»¥ä¸‹SQLä»£ç **ï¼š

```sql
-- åˆ›å»ºç”¨æˆ·èµ„æ–™è¡¨
CREATE TABLE IF NOT EXISTS profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  username VARCHAR(50) UNIQUE NOT NULL,
  display_name VARCHAR(100),
  avatar_url TEXT,
  bio TEXT,
  status VARCHAR(20) DEFAULT 'offline',
  last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºå¥½å‹å…³ç³»è¡¨
CREATE TABLE IF NOT EXISTS friendships (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  friend_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, friend_id)
);

-- åˆ›å»ºä¼šè¯è¡¨
CREATE TABLE IF NOT EXISTS conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type VARCHAR(20) NOT NULL DEFAULT 'private',
  name VARCHAR(100),
  avatar_url TEXT,
  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºä¼šè¯å‚ä¸è€…è¡¨
CREATE TABLE IF NOT EXISTS conversation_participants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_read_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(conversation_id, user_id)
);

-- åˆ›å»ºæ¶ˆæ¯è¡¨
CREATE TABLE IF NOT EXISTS messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
  sender_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  content TEXT,
  message_type VARCHAR(20) DEFAULT 'text',
  file_url TEXT,
  file_name TEXT,
  file_size INTEGER,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON messages(conversation_id);
CREATE INDEX IF NOT EXISTS idx_messages_created_at ON messages(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_conversation_participants_user_id ON conversation_participants(user_id);
CREATE INDEX IF NOT EXISTS idx_friendships_user_id ON friendships(user_id);
CREATE INDEX IF NOT EXISTS idx_friendships_friend_id ON friendships(friend_id);
```

4. ç‚¹å‡» `Run`

### ç¬¬3æ­¥ï¼šé…ç½®å®‰å…¨ç­–ç•¥ï¼ˆ1åˆ†é’Ÿï¼‰
1. åœ¨åŒä¸€ä¸ªSQL Editorä¸­å†åˆ›å»ºä¸€ä¸ªæ–°æŸ¥è¯¢
2. **å¤åˆ¶ç²˜è´´ä»¥ä¸‹RLSç­–ç•¥**ï¼š

```sql
-- å¯ç”¨RLS
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE friendships ENABLE ROW LEVEL SECURITY;
ALTER TABLE conversations ENABLE ROW LEVEL SECURITY;
ALTER TABLE conversation_participants ENABLE ROW LEVEL SECURITY;
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- profilesè¡¨ç­–ç•¥
CREATE POLICY "ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰èµ„æ–™" ON profiles FOR SELECT USING (true);
CREATE POLICY "ç”¨æˆ·å¯ä»¥æ’å…¥è‡ªå·±çš„èµ„æ–™" ON profiles FOR INSERT WITH CHECK (auth.uid() = id);
CREATE POLICY "ç”¨æˆ·å¯ä»¥æ›´æ–°è‡ªå·±çš„èµ„æ–™" ON profiles FOR UPDATE USING (auth.uid() = id);

-- friendshipsè¡¨ç­–ç•¥
CREATE POLICY "ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ä¸è‡ªå·±ç›¸å…³çš„å¥½å‹å…³ç³»" ON friendships 
  FOR SELECT USING (auth.uid() = user_id OR auth.uid() = friend_id);
CREATE POLICY "ç”¨æˆ·å¯ä»¥åˆ›å»ºå¥½å‹è¯·æ±‚" ON friendships 
  FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "ç”¨æˆ·å¯ä»¥æ›´æ–°å¥½å‹è¯·æ±‚çŠ¶æ€" ON friendships 
  FOR UPDATE USING (auth.uid() = user_id OR auth.uid() = friend_id);
CREATE POLICY "ç”¨æˆ·å¯ä»¥åˆ é™¤å¥½å‹å…³ç³»" ON friendships 
  FOR DELETE USING (auth.uid() = user_id OR auth.uid() = friend_id);

-- conversationsè¡¨ç­–ç•¥
CREATE POLICY "ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å‚ä¸çš„ä¼šè¯" ON conversations 
  FOR SELECT USING (
    id IN (
      SELECT conversation_id FROM conversation_participants WHERE user_id = auth.uid()
    )
  );
CREATE POLICY "ç”¨æˆ·å¯ä»¥åˆ›å»ºä¼šè¯" ON conversations 
  FOR INSERT WITH CHECK (auth.uid() = created_by);
CREATE POLICY "åˆ›å»ºè€…å¯ä»¥æ›´æ–°ä¼šè¯" ON conversations 
  FOR UPDATE USING (auth.uid() = created_by);

-- conversation_participantsè¡¨ç­–ç•¥
CREATE POLICY "ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ä¼šè¯å‚ä¸è€…" ON conversation_participants 
  FOR SELECT USING (
    conversation_id IN (
      SELECT conversation_id FROM conversation_participants WHERE user_id = auth.uid()
    )
  );
CREATE POLICY "ä¼šè¯åˆ›å»ºè€…å¯ä»¥æ·»åŠ å‚ä¸è€…" ON conversation_participants 
  FOR INSERT WITH CHECK (
    conversation_id IN (
      SELECT id FROM conversations WHERE created_by = auth.uid()
    ) OR user_id = auth.uid()
  );

-- messagesè¡¨ç­–ç•¥
CREATE POLICY "ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å‚ä¸ä¼šè¯çš„æ¶ˆæ¯" ON messages 
  FOR SELECT USING (
    conversation_id IN (
      SELECT conversation_id FROM conversation_participants WHERE user_id = auth.uid()
    )
  );
CREATE POLICY "ç”¨æˆ·å¯ä»¥å‘é€æ¶ˆæ¯" ON messages 
  FOR INSERT WITH CHECK (
    auth.uid() = sender_id AND
    conversation_id IN (
      SELECT conversation_id FROM conversation_participants WHERE user_id = auth.uid()
    )
  );
```

3. ç‚¹å‡» `Run`

### ç¬¬4æ­¥ï¼šå¼€å¯å®æ—¶åŠŸèƒ½ï¼ˆ1åˆ†é’Ÿï¼‰
1. è¿›å…¥ `Database` â†’ `Replication`
2. æ‰¾åˆ°ä»¥ä¸‹è¡¨ï¼Œåˆ†åˆ«ç‚¹å‡»å¼€å¯Realtimeï¼š
   - `messages` 
   - `conversation_participants`
   - `profiles`
3. æ¯ä¸ªè¡¨ç‚¹å‡»åä¼šæœ‰ç»¿è‰²æç¤º"Realtime enabled"

### ç¬¬5æ­¥ï¼šæµ‹è¯•åº”ç”¨ï¼ˆ1åˆ†é’Ÿï¼‰
1. æ‰“å¼€ä½ çš„åº”ç”¨ï¼š**https://goakay1ooz7z.space.minimaxi.com**
2. ç‚¹å‡»æ³¨å†Œï¼Œæµ‹è¯•èƒ½å¦æˆåŠŸæ³¨å†Œ
3. å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œè¯´æ˜é…ç½®å®Œæˆï¼âœ…

## ğŸ‰ é…ç½®å®Œæˆï¼

å®Œæˆåä½ çš„åº”ç”¨å°†æ”¯æŒï¼š
- âœ… ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- âœ… ç”¨æˆ·æœç´¢å’Œå¥½å‹æ·»åŠ 
- âœ… å®æ—¶èŠå¤©ï¼ˆç§èŠå’Œç¾¤èŠï¼‰
- âœ… æ¶ˆæ¯å†å²è®°å½•
- âœ… æ–‡ä»¶åˆ†äº«åŠŸèƒ½
- âœ… å®Œç¾çš„ç§»åŠ¨ç«¯ä½“éªŒ

## ğŸ“± æ³¨æ„äº‹é¡¹

- å»ºè®®ç”¨æ‰‹æœºæ‰“å¼€åº”ç”¨ï¼Œä½“éªŒæœ€ä½³
- å¯ä»¥åœ¨ä¸åŒè®¾å¤‡ä¸Šæ³¨å†Œå¤šä¸ªæµ‹è¯•è´¦å·æµ‹è¯•èŠå¤©åŠŸèƒ½
- å¦‚éœ€æ–‡ä»¶åˆ†äº«åŠŸèƒ½ï¼Œå¯ä»¥åˆ›å»ºStorageå­˜å‚¨æ¡¶

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š
1. é‚®ç®±è®¤è¯æ˜¯å¦å·²å¼€å¯
2. æ•°æ®åº“è¡¨æ˜¯å¦æˆåŠŸåˆ›å»º
3. RLSç­–ç•¥æ˜¯å¦å·²åº”ç”¨

**æ€»å…±åªéœ€5åˆ†é’Ÿå°±èƒ½è®©ä½ çš„å³æ—¶é€šè®¯åº”ç”¨å®Œå…¨å¯ç”¨ï¼** ğŸš€