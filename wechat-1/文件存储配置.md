# ğŸ“ æ–‡ä»¶å­˜å‚¨é…ç½®ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

## æ·»åŠ æ–‡ä»¶åˆ†äº«åŠŸèƒ½

å¦‚æœéœ€è¦å›¾ç‰‡å’Œæ–‡ä»¶åˆ†äº«åŠŸèƒ½ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤åˆ›å»ºå­˜å‚¨æ¡¶ï¼š

### 1. åˆ›å»ºå¤´åƒå­˜å‚¨æ¡¶
1. è¿›å…¥ `Storage`
2. ç‚¹å‡» `New bucket`
3. æ¡¶åç§°ï¼š`avatars`
4. ç‚¹å‡» `Create bucket`
5. ç‚¹å‡» `Make public`
6. è¿›å…¥ `Policies`ï¼Œæ·»åŠ ä»¥ä¸‹ç­–ç•¥ï¼š

```sql
-- å¤´åƒå­˜å‚¨æ¡¶RLSç­–ç•¥
CREATE POLICY "ä»»ä½•äººå¯ä»¥æŸ¥çœ‹å¤´åƒ" ON storage.objects FOR SELECT USING (bucket_id = 'avatars');
CREATE POLICY "ç”¨æˆ·å¯ä»¥ä¸Šä¼ è‡ªå·±çš„å¤´åƒ" ON storage.objects FOR INSERT WITH CHECK (bucket_id = 'avatars' AND auth.uid()::text = (storage.foldername(name))[1]);
CREATE POLICY "ç”¨æˆ·å¯ä»¥æ›´æ–°è‡ªå·±çš„å¤´åƒ" ON storage.objects FOR UPDATE USING (bucket_id = 'avatars' AND auth.uid()::text = (storage.foldername(name))[1]);
CREATE POLICY "ç”¨æˆ·å¯ä»¥åˆ é™¤è‡ªå·±çš„å¤´åƒ" ON storage.objects FOR DELETE USING (bucket_id = 'avatars' AND auth.uid()::text = (storage.foldername(name))[1]);
```

### 2. åˆ›å»ºèŠå¤©æ–‡ä»¶å­˜å‚¨æ¡¶
1. å†æ¬¡ç‚¹å‡» `New bucket`
2. æ¡¶åç§°ï¼š`chat-files`
3. ç‚¹å‡» `Create bucket`
4. ç‚¹å‡» `Make public`
5. è¿›å…¥ `Policies`ï¼Œæ·»åŠ ä»¥ä¸‹ç­–ç•¥ï¼š

```sql
-- èŠå¤©æ–‡ä»¶å­˜å‚¨æ¡¶RLSç­–ç•¥
CREATE POLICY "å‚ä¸è€…å¯ä»¥æŸ¥çœ‹èŠå¤©æ–‡ä»¶" ON storage.objects FOR SELECT USING (bucket_id = 'chat-files');
CREATE POLICY "å‚ä¸è€…å¯ä»¥ä¸Šä¼ èŠå¤©æ–‡ä»¶" ON storage.objects FOR INSERT WITH CHECK (bucket_id = 'chat-files');
CREATE POLICY "æ–‡ä»¶æ‹¥æœ‰è€…å¯ä»¥æ›´æ–°èŠå¤©æ–‡ä»¶" ON storage.objects FOR UPDATE USING (bucket_id = 'chat-files');
CREATE POLICY "æ–‡ä»¶æ‹¥æœ‰è€…å¯ä»¥åˆ é™¤èŠå¤©æ–‡ä»¶" ON storage.objects FOR DELETE USING (bucket_id = 'chat-files');
```

## æ–‡ä»¶ä¸Šä¼ é™åˆ¶å»ºè®®
- å¤´åƒï¼š5MBï¼Œimage/*ç±»å‹
- èŠå¤©æ–‡ä»¶ï¼š10MBï¼Œimage/*, application/*, text/*ç±»å‹

é…ç½®å®Œæˆåï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨èŠå¤©ä¸­åˆ†äº«å›¾ç‰‡å’Œæ–‡ä»¶äº†ï¼